name: $(BuildDefinitionName)_$(Date:yyyyMMdd)$(Rev:.rr)

phases:
- phase: 'test'
  queue:
    name: 'Hosted macOS Preview'
    parallel: 1
    matrix:
      python:
        toxenv: 'py3'

  steps:
  - script: 'python3 -m pip install -U tox setuptools'
    displayName: install tox

  - script: 'python3 -m tox -e $(toxenv) --notest'
    displayName: acquire env dependencies

  - script: 'python3 -m tox -e $(toxenv)'
    displayName: run tests

  - task: PublishTestResults@2
    displayName: publish test results
    inputs:
      testResultsFiles: '.tox/test-results.*.xml'
      mergeTestResults: true
      testRunTitle: 'mac py3'
      platform: mac
